import{A,E,u as ue,a as k,r as g,b as I,c as ee,g as pe,d as xe,e as me,j as e,K as b,R as N,Q as l,f as H,h as je,S as F,i as ve,l as ye,C as X,W as Ne,O as ge,H as be,B as Pe,F as Ce,k as fe,m as ke}from"./index-5cd9f330.js";const Ae=async t=>(await A.post(E.CREATE_ORDER,t.data,{headers:{Authorization:t.token}})).data,Ee=async t=>(await A.post(E.SEND_MOBILE_OTP,t.data,{headers:{Authorization:t.token}})).data,Oe=async t=>(await A.get(`${E.VALIDATE_PIN}/${t}`)).data,Re=async t=>(await A.post(E.VERIFY_MOBILE_OTP,t.data,{headers:{Authorization:t.token}})).data,Te=async t=>(await A.post(E.VERIFY_PAYMENT,t.data,{headers:{Authorization:t.token}})).data,Ie="/assets/icons/android-chrome-192x192.png",_e=()=>{const t=ue(),{isLoading:m,mutateAsync:v}=k(b.CREATE_ORDER,Ae),[_,ae]=g.useState(!1),{isLoading:B,mutateAsync:se}=k(b.VERIFY_PAYMENT,Te),{isLoading:q,data:d,error:U,mutateAsync:re}=k(b.SEND_MOBILE_OTP,Ee),{isLoading:w,data:u,error:V,mutateAsync:ne}=k(b.VERIFY_MOBILE_OTP,Re),{data:p,error:Y,isLoading:L,mutateAsync:ie}=k(b.VALIDATE_PIN,Oe),y=I(s=>s.cartReducer.cartItem),O=I(s=>s.personalDetailsReducer.token),r=I(s=>s.personalDetailsReducer.profileData),K=ee(),D=g.useMemo(()=>y.length>0?y.reduce((s,n)=>s+(n==null?void 0:n.totalPrice),0):0,[y]),S=g.useMemo(()=>pe(p,Y),[p,Y]),z=g.useMemo(()=>xe(d,U),[d,U]),M=g.useMemo(()=>me(u,V),[u,V]),R=r!=null&&r.name?r.name.split(" "):[],[a,le]=g.useState({firstName:R.length>0?R[0]:"",lastName:R.length>1?R[1]:"",companyName:"",country:r!=null&&r.country?r.country:"India",streetAddress1:r!=null&&r.address?r.address:"",streetAddress2:"",city:r!=null&&r.city?r.city:"",state:r!=null&&r.state?r.state:"Andhra Pradesh",zip:r!=null&&r.zipCode?r.zipCode:"",phone:r!=null&&r.phoneNumber?r.phoneNumber:"",email:r!=null&&r.email?r==null?void 0:r.email:"",notes:"",otp:""}),o=(s,n)=>{le(c=>({...c,[s]:n.target.value}))},te=()=>{ae(s=>!s)},de=()=>{var s;if(((s=p==null?void 0:p.data)==null?void 0:s.pincode)!==a.zip){if(!N.ZIP.test(a.zip)){l.warn("Please enter a valid 6 digit Pin Code");return}ie(a.zip).then(n=>{if(n.status===200){l.success(n==null?void 0:n.message);return}throw n==null?void 0:n.error}).catch(n=>{var c,x,P,C;return l.error((x=(c=n.response)==null?void 0:c.data)!=null&&x.error?(C=(P=n.response)==null?void 0:P.data)==null?void 0:C.error:"Unable to check this PIN Code availability!")})}},$=async()=>{await t.invalidateQueries(b.ORDERS)},oe=()=>{const s=H([{key:"Phone Number",value:a.phone,regex:N.PHONE}]);if(s)return l.error(s);re({data:{countryCode:"+91",phoneNumber:a.phone},token:O}).then(n=>{n.status===200&&l.success(n.message)}).catch(n=>{var c,x;return l.error((x=(c=n.response)==null?void 0:c.data)!=null&&x.error?n.response.data.error:"Unable to send OTP right now!")})},ce=()=>{const s=H([{key:"OTP",value:a.otp,regex:N.OTP}]);if(s)return l.error(s);ne({data:{countryCode:"+91",phoneNumber:a.phone,otp:a.otp},token:O}).then(n=>{n.status===200&&l.success(n.message)}).catch(n=>{var c,x;return l.error((x=(c=n.response)==null?void 0:c.data)!=null&&x.error?n.response.data.error:"Unable to verify OTP right now!")})},he=s=>{var C,G;s.preventDefault();const n=je([{key:"First Name",value:a.firstName},{key:"Last Name",value:a.lastName},{key:"Country",value:a.country},{key:"Street Address",value:a.streetAddress1},{key:"City",value:a.city},{key:"State",value:a.state},{key:"Postal Code",value:a.zip},{key:"Phone Number",value:a.phone},{key:"Email Address",value:a.email}]);if(n){l.error(n);return}if(!a.otp)return l.error("Please verify your Mobile Number!");const c=H([{key:"Phone Number",value:a.phone,regex:N.PHONE},{key:"Email",value:a.email,regex:N.EMAIL},{key:"Postal Code",value:a.zip,regex:N.ZIP},{key:"OTP",value:a.otp,regex:N.OTP}]);if(c){l.error(c);return}if(((C=p==null?void 0:p.data)==null?void 0:C.pincode)!==a.zip){l.error("Please check PIN Code availability first!");return}if(!((G=p==null?void 0:p.data)!=null&&G.is_deliverable)){l.error("Delivery not available on this pincode");return}if(!d||(d==null?void 0:d.status)!==200){l.error((d==null?void 0:d.error)||"Please verify your mobile number first!");return}if(!u||(u==null?void 0:u.status)!==200){l.error((u==null?void 0:u.error)||"Please click on Verify OTP!");return}if(m||B||L||q||w)return;const x=y.map(i=>({size:i==null?void 0:i.size,quantity:i==null?void 0:i.quantity,colorId:i==null?void 0:i.colorId,productId:i==null?void 0:i._id})),P={payment_type:_?"ONLINE":"COD",additional_info:a.notes,delivery_details:{firstName:a.firstName,lastName:a.lastName,companyName:a.companyName,streetAddress1:a.streetAddress1,streetAddress2:a.streetAddress2,city:a.city,state:a.state,zip:a.zip,country:a.country,phone:a.phone,email:a.email},products_details:x};v({data:P,token:O}).then(async i=>{if(i.status===200){if(P.payment_type==="COD"){$(),l.success(i==null?void 0:i.message),K(F.PROFILE,{state:{isOrderActive:!0}});return}ve(X.RAZORPAY_SCRIPT)||await ye(X.RAZORPAY_SCRIPT);const T={order_id:i.data.order_id,name:"the zenky",key:"rzp_test_cFhbLEd61xfdx6",image:Ie,theme:{color:"#262626"},handler:async j=>{se({data:{orderId:j.razorpay_order_id,paymentId:j.razorpay_payment_id},token:O}).then(h=>{h.status===200&&($(),l.success(h==null?void 0:h.message),K(F.PROFILE,{state:{isOrderActive:!0}}))}).catch(h=>{var Z,J,W,Q;return l.error((J=(Z=h.response)==null?void 0:Z.data)!=null&&J.error?(Q=(W=h.response)==null?void 0:W.data)==null?void 0:Q.error:"Unable to verify payment!")})}},f=new window.Razorpay(T);f.on("payment.failed",function(j){var h;l.error(((h=j==null?void 0:j.error)==null?void 0:h.description)||"Unable to process your payment! Please try again later.")}),f.open()}}).catch(i=>{var T,f,j,h;return l.error((f=(T=i.response)==null?void 0:T.data)!=null&&f.error?(h=(j=i.response)==null?void 0:j.data)==null?void 0:h.error:"Unable to place order right now!")})};return e.jsxs("form",{className:"row",onSubmit:he,children:[e.jsx("div",{className:"col-lg-7",children:e.jsxs("div",{className:"billing-info-wrap mr-100",children:[e.jsx("h3",{children:"Billing Details"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6 col-md-6",children:e.jsxs("div",{className:"billing-info mb-25",children:[e.jsxs("label",{children:["First name"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsx("input",{type:"text",value:a.firstName,onChange:o.bind(void 0,"firstName"),required:!0})]})}),e.jsx("div",{className:"col-lg-6 col-md-6",children:e.jsxs("div",{className:"billing-info mb-25",children:[e.jsxs("label",{children:["Last name"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsx("input",{type:"text",value:a.lastName,onChange:o.bind(void 0,"lastName"),required:!0})]})}),e.jsx("div",{className:"col-lg-12 col-md-12",children:e.jsxs("div",{className:"billing-info mb-25 ",children:[e.jsxs("label",{children:["Phone"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsxs("div",{className:"pin",children:[e.jsx("input",{type:"text",value:a.phone,className:z.className,disabled:(d==null?void 0:d.status)===200,onChange:o.bind(void 0,"phone"),maxLength:10,required:!0}),(d==null?void 0:d.status)===200?null:e.jsx("span",{onClick:q?void 0:oe,children:q?"Sending":"Send OTP"})]}),e.jsx("small",{className:z.className,children:z.text})]})}),(d==null?void 0:d.status)===200?e.jsx("div",{className:"col-lg-12 col-md-12",children:e.jsxs("div",{className:"billing-info mb-25",children:[e.jsxs("label",{children:["OTP"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsxs("div",{className:"pin",children:[e.jsx("input",{type:"text",value:a.otp,className:M.className,onChange:o.bind(void 0,"otp"),maxLength:6,required:!0}),(u==null?void 0:u.status)===200?null:e.jsx("span",{onClick:w?void 0:ce,children:w?"Verifying":"Verify OTP"})]}),e.jsx("small",{className:M.className,children:M.text})]})}):null,e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"billing-info mb-25",children:[e.jsx("label",{children:"Company name (optional) "}),e.jsx("input",{type:"text",value:a.companyName,onChange:o.bind(void 0,"companyName")})]})}),e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"billing-select mb-25",children:[e.jsxs("label",{children:["Country"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsx("select",{className:"select-active",value:a.country,onChange:o.bind(void 0,"country"),required:!0,children:e.jsx("option",{value:"India",children:"India"})})]})}),e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"billing-info mb-25",children:[e.jsxs("label",{children:["Street address"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsx("input",{className:"billing-address",placeholder:"House number and street name",type:"text",value:a.streetAddress1,onChange:o.bind(void 0,"streetAddress1"),required:!0}),e.jsx("input",{placeholder:"Apartment, suite, unit etc. (optional)",type:"text",value:a.streetAddress2,onChange:o.bind(void 0,"streetAddress2")})]})}),e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"billing-info mb-25",children:[e.jsxs("label",{children:["Town / City"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsx("input",{type:"text",value:a.city,onChange:o.bind(void 0,"city"),required:!0})]})}),e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"billing-select mb-25",children:[e.jsxs("label",{children:["State"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsxs("select",{className:"select-active",value:a.state,onChange:o.bind(void 0,"state"),required:!0,children:[e.jsx("option",{value:"Andhra Pradesh",children:"Andhra Pradesh"}),e.jsx("option",{value:"Andaman and Nicobar Islands",children:"Andaman and Nicobar Islands"}),e.jsx("option",{value:"Arunachal Pradesh",children:"Arunachal Pradesh"}),e.jsx("option",{value:"Assam",children:"Assam"}),e.jsx("option",{value:"Bihar",children:"Bihar"}),e.jsx("option",{value:"Chandigarh",children:"Chandigarh"}),e.jsx("option",{value:"Chhattisgarh",children:"Chhattisgarh"}),e.jsx("option",{value:"Dadar and Nagar Haveli",children:"Dadar and Nagar Haveli"}),e.jsx("option",{value:"Daman and Diu",children:"Daman and Diu"}),e.jsx("option",{value:"Delhi",children:"Delhi"}),e.jsx("option",{value:"Lakshadweep",children:"Lakshadweep"}),e.jsx("option",{value:"Puducherry",children:"Puducherry"}),e.jsx("option",{value:"Goa",children:"Goa"}),e.jsx("option",{value:"Gujarat",children:"Gujarat"}),e.jsx("option",{value:"Haryana",children:"Haryana"}),e.jsx("option",{value:"Himachal Pradesh",children:"Himachal Pradesh"}),e.jsx("option",{value:"Jammu and Kashmir",children:"Jammu and Kashmir"}),e.jsx("option",{value:"Jharkhand",children:"Jharkhand"}),e.jsx("option",{value:"Karnataka",children:"Karnataka"}),e.jsx("option",{value:"Kerala",children:"Kerala"}),e.jsx("option",{value:"Madhya Pradesh",children:"Madhya Pradesh"}),e.jsx("option",{value:"Maharashtra",children:"Maharashtra"}),e.jsx("option",{value:"Manipur",children:"Manipur"}),e.jsx("option",{value:"Meghalaya",children:"Meghalaya"}),e.jsx("option",{value:"Mizoram",children:"Mizoram"}),e.jsx("option",{value:"Nagaland",children:"Nagaland"}),e.jsx("option",{value:"Odisha",children:"Odisha"}),e.jsx("option",{value:"Punjab",children:"Punjab"}),e.jsx("option",{value:"Rajasthan",children:"Rajasthan"}),e.jsx("option",{value:"Sikkim",children:"Sikkim"}),e.jsx("option",{value:"Tamil Nadu",children:"Tamil Nadu"}),e.jsx("option",{value:"Telangana",children:"Telangana"}),e.jsx("option",{value:"Tripura",children:"Tripura"}),e.jsx("option",{value:"Uttar Pradesh",children:"Uttar Pradesh"}),e.jsx("option",{value:"Uttarakhand",children:"Uttarakhand"}),e.jsx("option",{value:"West Bengal",children:"West Bengal"})]})]})}),e.jsx("div",{className:"col-lg-12 col-md-12",children:e.jsxs("div",{className:"billing-info mb-25 ",children:[e.jsxs("label",{children:["Postcode / ZIP"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsxs("div",{className:"pin",children:[e.jsx("input",{type:"text",value:a.zip,className:S.className,onChange:o.bind(void 0,"zip"),required:!0}),e.jsx("span",{onClick:L?void 0:de,children:L?"Checking":"Check"})]}),e.jsx("small",{className:S.className,children:S.text})]})}),e.jsx("div",{className:"col-lg-12 col-md-12",children:e.jsxs("div",{className:"billing-info mb-25",children:[e.jsxs("label",{children:["Email Address"," ",e.jsx("abbr",{className:"required",title:"Required",children:"*"})]}),e.jsx("input",{type:"text",value:a.email,onChange:o.bind(void 0,"email"),required:!0})]})})]}),e.jsxs("div",{className:"additional-info-wrap",children:[e.jsx("h3",{children:"Additional information"}),e.jsx("label",{children:"Order notes (optional)"}),e.jsx("textarea",{placeholder:"Notes about your order, e.g. special notes for delivery. ",name:"message",value:a.notes,onChange:o.bind(void 0,"notes")})]})]})}),e.jsx("div",{className:"col-lg-5",children:e.jsxs("div",{className:"your-order-area",children:[e.jsx("h3",{children:"Your order"}),e.jsxs("div",{className:"your-order-wrap gray-bg-4",children:[e.jsxs("div",{className:"your-order-info-wrap",children:[e.jsx("div",{className:"your-order-info",children:e.jsx("ul",{children:e.jsxs("li",{children:["Product ",e.jsx("span",{children:"Total"})]})})}),e.jsx("div",{className:"your-order-middle",children:e.jsx("ul",{children:y==null?void 0:y.map(s=>e.jsxs("li",{children:[s==null?void 0:s.name," X ",s==null?void 0:s.quantity," ",e.jsxs("span",{children:["₹",s==null?void 0:s.totalPrice," "]})]},`checkout_item_${s==null?void 0:s._id}_${s==null?void 0:s.colorName}_${s==null?void 0:s.size}`))})}),e.jsx("div",{className:"your-order-info order-subtotal",children:e.jsx("ul",{children:e.jsxs("li",{children:["Subtotal ",e.jsxs("span",{children:["₹",D]})]})})}),e.jsx("div",{className:"your-order-info order-total",children:e.jsx("ul",{children:e.jsxs("li",{children:["Total ",e.jsxs("span",{children:["₹",D]})]})})})]}),!1,e.jsx("div",{className:`payment-method ${_?"":"active"}`,children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("input",{type:"radio",name:"payment",id:"cod",checked:!_,onChange:te}),e.jsx("label",{htmlFor:"cod",children:"Cash On Delivery"})]})}),e.jsxs("div",{className:"condition-wrap",children:[e.jsxs("p",{children:["Your personal data will be used to process your order, support your experience throughout this website, and for other purposes described in our"," ",e.jsx("a",{href:"#",children:"privacy policy"})]}),e.jsxs("div",{className:"condition-form mb-25",children:[e.jsx("input",{type:"checkbox",required:!0}),e.jsxs("span",{children:["I have read and agree to the website"," ",e.jsx("a",{href:"#",children:"terms and conditions"}),e.jsx("span",{className:"star",children:"*"})]})]})]})]}),e.jsx("div",{className:"Place-order mt-30",children:e.jsx("button",{type:"submit",children:m||B?e.jsx("div",{className:"loading-spinner"}):"Place Order"})})]})})]})},qe=()=>e.jsx("div",{className:"checkout-main-area pt-100 pb-100",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"checkout-wrap",children:e.jsx(_e,{})})})}),Le=()=>{const t=I(v=>v.cartReducer.cartItem.length),m=ee();return g.useEffect(()=>{t<1&&m(F.CART)},[t]),e.jsxs(Ne,{children:[e.jsx(ge,{}),e.jsx(be,{}),e.jsx(Pe,{title:"Checkout"}),e.jsx(qe,{}),e.jsx(Ce,{}),e.jsx(fe,{}),e.jsx(ke,{})]})};export{Le as default};
